      - name: Disable NLA and Enable RDP1 for user
        run: |
          # Disable Network Level Authentication (NLA) for security reasons on a temporary RDP session.
          Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\SecurityProviders\WDigest" -Name "UserAuthentication" -Value 0 -Force
          Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "SecurityLayer" -Value 0 -Force

          # Remove any existing rule with the same name to avoid duplication
          netsh advfirewall firewall delete rule name="RDP-Tailscale"

          # Add a rule to allow RDP through the firewall for the Tailscale IP
          netsh advfirewall firewall add rule name="RDP-Tailscale" dir=in action=allow protocol=TCP localport=3389 remoteip=any

          # Generate a random password for the user with at least one of each character type
          $rawPassword = ""
          $charSet = [char[]]([char]'!'..[char]'~') # Printable ASCII characters (33 to 126) excluding space
          $rawPassword += $charSet.Upper | Get-Random -Count 4
          $rawPassword += $charSet.Lower | Get-Random -Count 4
          $rawPassword += $charSet.Number | Get-Random -Count 4
          $rawPassword += $charSet.Special | Get-Random -Count 4
          $password = -join $rawPassword | Sort-Object | Get-Random -InputObject $rawPassword -Count 16

          # Set the password for the current user and display it securely
          $currentUser = (Get-WmiObject -Class Win32_ComputerSystem).UserName.Split('\')[-1]
          Write-Host "Setting password for user: $currentUser"
          (Get-LocalUser -Name $currentUser).SetPassword($password)
          Write-Host "Generated Password: $password"
          Write-Host "You can now connect to RDP using the password above."

          # Remove the RDP service registry settings when the runner exits (Make sure $installerPath is defined or use the correct path)
          # Note: The original script seems to be missing the definition for $installerPath. Assuming it means the RDP-Tcp path for cleanup, but keeping the original line as is.
          Remove-ItemProperty -Path $installerPath -Force
